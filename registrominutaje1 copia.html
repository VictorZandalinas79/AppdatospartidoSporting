<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPORTING DE CASTELLO - Fundado en 1970</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>

    <style>
        /* Estilos generales */
        body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    padding: 0;
    background-image: linear-gradient(to bottom right, rgba(255, 255, 255, 0.3), rgba(0, 0, 0, 0.7)), url('https://sportingdecastellocom.files.wordpress.com/2023/10/whatsapp-image-2023-10-04-at-22.53.28-1.jpeg?w=NaN&h=');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color: blanchedalmond;
    position: relative;
    height: 100vh;
    text-shadow: 1px 1px 2px black;
}

        /* Estilos para los botones */
        .boton {
            background-color: #4CAF50; /* Verde */
            border: none;
            color: rgb(15, 7, 7);
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            transition-duration: 0.4s;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        }

        @font-face {
    font-family: 'Digital';
    src: url('ruta/a/tu/fuente/digital.woff') format('woff');
}

.videomarcador-estilo {
    display: inline-block;
    background: rgba(0, 0, 0, 0.75) url('https://sportingdecastellocom.files.wordpress.com/2024/02/3b8ffe4e-1bbd-4093-a6f1-8ec77c0639ff.jpg?w=NaN&h=') no-repeat center center;
    background-size: cover;
    color: #c0e713;
    padding: 10px 20px;
    font-size: 50px;
    font-family: 'cñas', sans-serif;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
    border: 2px solid #FFF;
}

        .boton:hover {
            background-color: rgb(12, 10, 10);
            color: black;
            border: 2px solid #4CAF50;
        }

        /* Ajustes de estilo para móviles */
        @media screen and (max-width: 768px) {
            h2 {
                font-size: 20px;
            }
            .boton {
                padding: 10px;
                font-size: 16px;
            }
        }
        .boton-cronometro {
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    background-color: #4CAF50;
    color: white;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
}
.tactile-button {
    margin: 0 5px; /* Añade un margen a los lados de cada botón para separarlos del número */
}

.numero-span {
    display: inline-block;
    margin: 0 5px; /* Añade un margen a los lados del número para separarlo de los botones */
}
.botonSuplenteTitular {
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    color: white;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s, box-shadow 0.3s;
}

.fondo-verde {
    background-color: #4CAF50; /* Verde */
}

.fondo-verde:hover {
    box-shadow: 0 2px 4px 0 rgba(0, 128, 0, 0.24), 0 0 8px 0 rgba(0, 128, 0, 0.12);
}

.fondo-rojo {
    background-color: #f44336; /* Rojo */
}

.fondo-rojo:hover {
    box-shadow: 0 2px 4px 0 rgba(255, 0, 0, 0.24), 0 0 8px 0 rgba(255, 0, 0, 0.12);
}
.boton-cronometro i {
    font-size: 20px; /* Tamaño de los íconos */
}
#contador-moderno-titulares {
    background-color: #4CAF50; /* Color de fondo */
    color: white; /* Color de texto */
    padding: 10px; /* Espaciado interno */
    border-radius: 5px; /* Bordes redondeados */
    box-shadow: 0px 2px 5px rgba(0,0,0,0.3); /* Sombra para darle profundidad */
    display: inline-block; /* Para que adopte el tamaño de su contenido */
    margin-top: 10px; /* Espacio arriba */
}

#contador-moderno-titulares span {
    font-weight: bold; /* Texto en negrita */
}

.boton-cronometro:hover {
    background-color: #367c39; /* Color más oscuro al pasar el mouse */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
}

.boton-cronometro:active {
    transform: scale(0.95); /* Efecto de presionado */
}
#mensaje-advertencia {
    position: fixed;
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    background-color: rgba(255, 0, 0, 0.8);
    color: white;
    padding: 20px;
    border-radius: 10px;
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    box-shadow: 0px 0px 10px #000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.fas.fa-exclamation-circle {
    margin-left: 10px;
    font-size: 30px;
}

        /* Estilos para tablas */
        table {
    width: 60%; /* Ajusta el ancho de la tabla según tus necesidades */
    margin-left: auto; /* Centrar la tabla horizontalmente */
    margin-right: auto;
    border-collapse: collapse; /* Elimina el espacio entre las celdas */
    margin-top: 20px;
    box-shadow: 0 0 10px rgba(230, 230, 0, 0.75); /* Efecto de brillo para simular LED */
    background-color: #000000; /* Fondo negro para mayor contraste */
    color: #e6e600; /* Color de texto brillante */
    font-family: 'Digital-7', sans-serif; /* Fuente con estilo digital */
}

th, td {
    padding: 5px 10px; /* Reducir el padding para hacer las filas más estrechas */
    text-align: center;
    border: 1px solid #e6e600;
    text-shadow: 0 0 5px rgba(230, 230, 0, 0.75);
}

th {
    background-color: #222; /* Fondo oscuro para las cabeceras */
    color: white;
}

tr:hover {
    background-color: #333333; /* Cambio de color al pasar el mouse */
}

@font-face {
    font-family: 'Digital-7';
    src: url('digital-7.ttf') format('truetype'),
         url('digital-7-alternative.woff') format('woff'); /* Añadir una fuente alternativa */
}


@media screen and (max-width: 768px) {
    table {
        width: 100%; /* Ajusta el ancho de la tabla para dispositivos móviles */
    }
}

        #contador-titulares {
    font-size: 1.2em;
    margin-bottom: 10px;
    /* Añade aquí más estilos si lo deseas */
}

#tiempo {
    font-size: 48px; /* Tamaño grande para simular un videomarcador */
    color: #e6e600; /* Color brillante para el texto */
    text-shadow: 0px 0px 10px rgba(230, 230, 0, 0.75); /* Efecto de brillo para simular LED */
    font-family: 'Digital-7', sans-serif; /* Fuente con estilo digital */
    background-color: #000000; /* Fondo negro para mayor contraste */
    border: 2px solid #ffffff; /* Borde para simular el videomarcador */
    padding: 10px;
    border-radius: 10px; /* Bordes redondeados */
    display: inline-block;
    margin-bottom: 20px;
}

/* Importante: Debes importar una fuente digital para que se vea como un videomarcador */
@font-face {
    font-family: 'Digital-7';
    src: url('digital-7.ttf') format('truetype'); /* Asegúrate de tener la fuente digital-7 o una similar */
}
/* Si cada columna tiene una clase específica */
.columna-dorsal, .columna-jugador, .columna-equipo, .columna-cronometro {
    color: black;
}

/* Si prefieres aplicar el estilo basado en el índice de la columna */
#jugadores-table th:nth-child(1), /* Dorsal */
#jugadores-table th:nth-child(2), /* Jugador */
#jugadores-table th:nth-child(3), /* Equipo */
#jugadores-table th:nth-child(4) { /* Cronómetro */
    color: white;
}
<link rel="manifest" href="/manifest.json">

    </style>
</head>
<body>

    <img id="logo" src="https://sportingdecastellocom.files.wordpress.com/2023/09/logo.png?w=202&amp;h=129" alt="Logo">

    <h2 style="font-size: 30px; background-color: #af4c4c; color: white; padding: 10px;">SPORTING DE CASTELLÓ - Fundado en 1970</h2>

    <div class="botonera" id="botonera"></div>

    </div>
     <div id="cronometro">
        <button id="play" class="boton-cronometro" onclick="iniciarCronometro()"><i class="fas fa-play"></i></button>
<button id="stop" class="boton-cronometro" onclick="detenerCronometro()"><i class="fas fa-stop"></i></button>
<button id="reset" class="boton-cronometro" onclick="resetearCronometroGeneral()"><i class="fas fa-redo"></i></button>
        <span id="tiempo">00:00:00.000</span>
        <div>
    <label for="tipo-futbol">Selecciona el tipo de fútbol:</label>
    <select id="tipo-futbol" onchange="actualizarContadorTitulares()">
        <option value="8">Fútbol-8</option>
        <option value="11">Fútbol-11</option>
    </select>
    <id="videomarcador" style="text-align: center; margin-top: 20px;">
    <div class="videomarcador-estilo">
        <span id="equipo-local">Sporting de Castelló</span> <span id="goles-local">0</span> - <span id="goles-visitante">0</span> <span id="equipo-visitante">Rival</span>
    </div>
</div>
<div id="mensaje-advertencia" style="display: none;">Cuidado, te faltan jugadores <i class="fas fa-exclamation-circle"></i></div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</div>
    <div id="contador-moderno-titulares">
    <span>Titulares: </span><span id="numero-titulares-moderno">0</span>
</div>
    <table id="jugadores-table">
        <thead>
            <tr>
                <th>Dorsal</th>
                <th>Jugador</th>
                <th>Equipo</th>
                <th>Cronómetro</th>
                <th>Titular/Suplente</th>
                <th>Goles a favor</th>
                <th>Goles en contra</th>
                <th>Asistencia</th>
                <th>T. Amarilla</th>
                <th>T. Roja</th>

            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <label class="boton" for="file-input" onclick="abrirVentanaPop()">Cargar Jugadores</label>

    <button class="boton" onclick="limpiarTabla()">Limpiar Tabla</button>
    <button class="boton" onclick="exportarPartido()">Exportar Partido</button>
    <div id="formularioExportarPartido" style="background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); max-width: 600px; margin: auto;">
        <h2 style="color: #000; text-align: center; font-family: 'Roboto', sans-serif;">Datos Partido</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: space-around;">
            <div style="flex-basis: 45%; margin: 10px;">
                <label for="jornada" style="color: #000; margin-right: 10px;">Jornada:</label>
                <input type="text" id="jornada" placeholder="Ingrese la jornada" style="background-color: #fff; color: #000; border: 1px solid #000;">
            </div>
    
            <div style="flex-basis: 45%; margin: 10px;">
                <label for="fecha" style="color: #000; margin-right: 10px;">Fecha:</label>
                <input type="date" id="fecha" style="background-color: #fff; color: #000; border: 1px solid #000;">
            </div>
    
            <div style="flex-basis: 45%; margin: 10px;">
                <label for="equipo" style="color: #000; margin-right: 10px;">Equipo:</label>
                <input type="text" id="equipo" placeholder="Ingrese el equipo del Sporting" style="background-color: #fff; color: #000; border: 1px solid #000;">
            </div>
    
            <div style="flex-basis: 45%; margin: 10px;">
                <label for="rival" style="color: #000; margin-right: 10px;">Rival:</label>
                <input type="text" id="rival" placeholder="Ingrese el rival" style="background-color: #fff; color: #000; border: 1px solid #000;">
            </div>
    
            <div style="flex-basis: 45%; margin: 10px;">
                <label for="resultado" style="color: #000; margin-right: 10px;">Resultado:</label>
                <input type="text" id="resultado" placeholder="Ingrese el resultado" style="background-color: #fff; color: #000; border: 1px solid #000;">
            </div>
        </div>
    <table id="registro-table">
        <caption>Registros por tiempos</caption>
        <thead>
            <tr>
                <th>Tiempo</th>
                <th>Dorsal</th>
                <th>Nombre</th>
                <th>Evento</th>

            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <script>

    let cronometro;
        let milisegundos = 0;
        let segundos = 0;
        let minutos = 0;
        let horas = 0;
        let cronometroActivo = false;

        function iniciarCronometro() {
            if (!cronometroActivo) {
                cronometro = setInterval(actualizarCronometro, 10);
                cronometroActivo = true;
                iniciarCronometrosFilas();
            }
        }


        function detenerCronometro() {
            clearInterval(cronometro);
            cronometroActivo = false;
            detenerCronometrosFilas();
        }

        function resetearCronometroGeneral() {
    milisegundos = 0;
    segundos = 0;
    minutos = 0;
    horas = 0;
    actualizarTiempo();
    cronometroActivo = false;
}

        function actualizarCronometro() {
            milisegundos += 10;
            if (milisegundos === 1000) {
                milisegundos = 0;
                segundos++;
                if (segundos === 60) {
                    segundos = 0;
                    minutos++;
                    if (minutos === 60) {
                        minutos = 0;
                        horas++;
                    }
                }
            }
            actualizarTiempo();
        }
        function actualizarCronometrosFilas() {
    // Obtener todas las filas con cronómetros
    const filasConCronometro = document.querySelectorAll('.cronometro-fila');

    filasConCronometro.forEach(fila => {
        // Actualizar el cronómetro de cada fila
        // Por ejemplo, puedes necesitar actualizar el tiempo mostrado
        // Esto es solo un ejemplo genérico
        const cronometro = fila.querySelector('span');
        // Suponiendo que tienes una función para obtener el tiempo actualizado
        cronometro.textContent = obtenerTiempoActualizado();
    });
}


        function actualizarTiempo() {
            const tiempo = `${formatoDosDigitos(horas)}:${formatoDosDigitos(minutos)}:${formatoDosDigitos(segundos)}.${formatoTresDigitos(milisegundos)}`;
            document.getElementById('tiempo').textContent = tiempo;
            actualizarCronometrosFilas();
        }
        
        function abrirVentanaPop() {
    // Abre la ventana emergente con el HTML anterior
    const nuevaVentana = window.open('jugadoressporting22.html', 'VentanaFlotante', 'width=800, height=600');
    let intervalo = setInterval(function() {
        if (nuevaVentana.closed) {
            clearInterval(intervalo); // Detiene el intervalo cuando la ventana se cierra
            // Aquí puedes recargar la página o llamar a funciones específicas para actualizar datos
            location.reload(); // O cualquier función que actualice los datos sin recargar la página
        }
    }, 1000); // Verifica cada segundo si la ventana se ha cerrado
}
        function formatoDosDigitos(valor) {
            return valor < 10 ? `0${valor}` : valor;
        }

        function formatoTresDigitos(valor) {
            if (valor < 10) {
                return `00${valor}`;
            } else if (valor < 100) {
                return `0${valor}`;
            } else {
                return valor;
            }
        }

        function cargarJugadoresSeleccionados(jugadoresSeleccionados) {
    console.log('Cargando jugadores seleccionados en la ventana principal:', jugadoresSeleccionados);

    // Código para agregar los jugadores seleccionados a la tabla en la ventana principal
    jugadoresSeleccionados.forEach((jugador) => {
        agregarJugadorATabla(document.getElementById('jugadores-table'), jugador);
    });
}

document.addEventListener('DOMContentLoaded', () => {
    // Se carga la información al cargar la página
    const jugadoresSeleccionadosStorage = localStorage.getItem('jugadoresSeleccionados');
    if (jugadoresSeleccionadosStorage) {
        const jugadoresSeleccionados = JSON.parse(jugadoresSeleccionadosStorage);
        cargarJugadoresSeleccionados(jugadoresSeleccionados);
    }

    // Agregar el listener para el evento personalizado
    document.addEventListener('actualizarTablaPrincipal', () => {
        // Realiza la actualización de la tabla de jugadores o cualquier otra acción necesaria
        location.reload();
    });
});


function exportarSeleccionados() {
        // Obtener jugadores seleccionados y cargarlos en la tabla
        const jugadoresSeleccionadosStorage = localStorage.getItem('jugadoresSeleccionados');
        if (jugadoresSeleccionadosStorage) {
            const jugadoresSeleccionados = JSON.parse(jugadoresSeleccionadosStorage);
            cargarJugadoresSeleccionados(jugadoresSeleccionados);
        }

        // Resto de la lógica de exportación
        const jugadoresSeleccionados = obtenerJugadoresSeleccionados();
        console.log('Jugadores Seleccionados:', jugadoresSeleccionados);
        // Aquí puedes implementar la lógica para exportar los jugadores seleccionados

        // Emitir evento personalizado para actualizar la página principal
        const actualizarTablaEvent = new Event('actualizarTablaPrincipal');
        document.dispatchEvent(actualizarTablaEvent);
    }

    document.addEventListener('actualizarTablaPrincipal', () => {
    // Actualiza la tabla de jugadores o realiza cualquier otra acción necesaria
    actualizarTabla();
});

function actualizarTabla() {
    // Lógica para cargar la tabla principal
    const jugadoresSeleccionadosStorage = localStorage.getItem('jugadoresSeleccionados');
    if (jugadoresSeleccionadosStorage) {
      const jugadoresSeleccionados = JSON.parse(jugadoresSeleccionadosStorage);
      cargarJugadoresSeleccionados(jugadoresSeleccionados);
    }
  }

  // Agrega un escuchador de eventos para actualizar la tabla
  document.addEventListener('actualizarTablaPrincipal', actualizarTabla);

  function agregarJugadorATabla(tabla, jugador) {
        // Código para agregar un jugador a la tabla específica
        const tbody = tabla.querySelector('tbody');
        const fila = document.createElement('tr');
        fila.innerHTML = `
            <td>${jugador.Dorsal}</td>
            <td>${jugador.Jugador}</td>
            <td>${jugador.Equipo}</td>
        `;
        tbody.appendChild(fila);
        // Agregar celda de cronómetro
    const celdaCronometro = document.createElement('td');
    const cronometroFila = document.createElement('div');
    cronometroFila.classList.add('cronometro-fila');
    cronometroFila.innerHTML = '<span>00:00:00.000</span>';
    celdaCronometro.appendChild(cronometroFila);
    fila.appendChild(celdaCronometro);

    // Agregar celda de botón Titular/Suplente
    const celdaBotonera = document.createElement('td');
    const botonera = document.createElement('div');
    botonera.classList.add('botonera');
    botonera.innerHTML = `<button onclick="cambiarEstadoSuplenteTitular(this)" class="botonSuplenteTitular fondo-rojo">Suplente</button>`;
    celdaBotonera.appendChild(botonera);
    fila.appendChild(celdaBotonera);

      // Agregar celda de botones táctiles
    for (let i = 0; i < 5; i++) {
        const celdaBotonesTactiles = document.createElement('td');
        const botonRestar = document.createElement('button');
        const spanNumero = document.createElement('span');
        const botonSumar = document.createElement('button');

        botonRestar.classList.add('tactile-button');
        spanNumero.classList.add('numero-span');
        botonSumar.classList.add('tactile-button');

        botonRestar.textContent = '-';
        spanNumero.textContent = '0';
        botonSumar.textContent = '+';

        botonRestar.addEventListener('click', () => restarValor(spanNumero));
        botonSumar.addEventListener('click', () => sumarValor(spanNumero));

        celdaBotonesTactiles.appendChild(botonRestar);
        celdaBotonesTactiles.appendChild(spanNumero);
        celdaBotonesTactiles.appendChild(botonSumar);
        fila.appendChild(celdaBotonesTactiles);
    }
}

function obtenerDatosTabla() {
    const filas = document.querySelectorAll('#jugadores-table tbody tr');
    const datos = [];

    filas.forEach((fila) => {
        const jugador = {
            Dorsal: fila.cells[0].textContent,
            Jugador: fila.cells[1].textContent,
            Equipo: fila.cells[2].textContent,  // Agrega esta línea para incluir la columna de Equipo
        };

        datos.push(jugador);
    });

    return datos;
}
const jugadoresSeleccionados = obtenerJugadoresSeleccionados();
jugadoresSeleccionados.forEach(jugador => {
    agregarFilaTabla(jugador);
});

function obtenerJugadoresSeleccionados() {
    const checkboxes = document.querySelectorAll('#jugadores-table tbody input[name="seleccionar"]');
    const jugadoresSeleccionados = [];

    checkboxes.forEach((checkbox, index) => {
        if (checkbox.checked) {
            const fila = checkbox.closest('tr');
            const dorsal = fila.querySelector('td:nth-child(1)').textContent;
            const jugador = fila.querySelector('td:nth-child(2)').textContent;
            const equipo = fila.querySelector('td:nth-child(3)').textContent;
            const cronometro = fila.querySelector('.cronometro-fila span').textContent;
            const estado = fila.querySelector('.botonSuplenteTitular').textContent;

            jugadoresSeleccionados.push({
                Dorsal: dorsal,
                Jugador: jugador,
                Equipo: equipo,
                Cronometro: cronometro,
                Estado: estado,
            });
        }
    });

    return jugadoresSeleccionados;
}

function restarValor(spanNumero) {
    let valorActual = parseInt(spanNumero.textContent) || 0;

    if (spanNumero.parentElement.cellIndex === 5) {
        // Permitir números negativos en la sexta columna
        valorActual--;
    } else {
        // Restringir a valores no negativos en las demás columnas
        valorActual = Math.max(0, valorActual - 1);
    }

    spanNumero.textContent = valorActual;
}


function agregarFilaTabla(jugador) {
    console.log('Agregando fila para el jugador:', jugador);

    const tabla = document.querySelector('#jugadores-table');
    const tbody = tabla.querySelector('tbody');
    const fila = document.createElement('tr');

    for (const propiedad in jugador) {
        const celda = document.createElement('td');
        celda.textContent = jugador[propiedad];
        if (propiedad === 'Dorsal' || propiedad === 'Jugador' || propiedad === 'Equipo') {
            // Aplicar estilos específicos para las celdas de Dorsal, Jugador y Equipo
            celda.classList.add('negro');
        }
        fila.appendChild(celda);
    }

    // Agregar celda de cronómetro
    const celdaCronometro = document.createElement('td');
    const cronometroFila = document.createElement('div');
    cronometroFila.classList.add('cronometro-fila');
    cronometroFila.innerHTML = '<span>00:00:00</span>';
    celdaCronometro.appendChild(cronometroFila);
    fila.appendChild(celdaCronometro);

    // Agregar celda de botón Titular/Suplente
    const celdaBotonera = document.createElement('td');
    const botonera = document.createElement('div');
    botonera.classList.add('botonera');
    botonera.innerHTML = `<button onclick="cambiarEstadoSuplenteTitular(this)" class="botonSuplenteTitular fondo-rojo">Suplente</button>`;
    celdaBotonera.appendChild(botonera);
    fila.appendChild(celdaBotonera);

    console.log('Fila agregada:', fila);

    tbody.appendChild(fila);
}
        function crearBotonera() {
            const tabla = document.querySelector('#jugadores-table');
            const botonera = document.getElementById('botonera');
            botonera.innerHTML = '';
            const filas = tabla.querySelectorAll('tbody tr');

            filas.forEach((fila, index) => {
            });
        }
        let parte = 1; // Variable para almacenar el número de parte

function detenerCronometro() {
    clearInterval(cronometro);
    cronometroActivo = false;
    detenerCronometrosFilas();

    // Cambiar de 1ª parte a 2ª parte y viceversa
    parte = parte === 1 ? 2 : 1;
    document.getElementById('parte').textContent = `${parte}ª parte`;
}
function cambiarEstadoSuplenteTitular(boton) {
      const fila = boton.closest('tr');
    const estadoActual = boton.textContent;

    if (estadoActual === 'Titular') {
        detenerCronometroFila(fila);
        acumularTiempoFila(fila);
    } else {
        reiniciarCronometroFila(fila);
    }

   // Cambiar el estado y actualizar los estilos según corresponda
    const nuevoEstado = estadoActual === 'Suplente' ? 'Titular' : 'Suplente';
    boton.textContent = nuevoEstado;
    boton.classList.toggle('fondo-verde', nuevoEstado === 'Titular');
    boton.classList.toggle('fondo-rojo', nuevoEstado === 'Suplente');

    // Reorganizar las filas en la tabla
    const dorsal = parseInt(fila.cells[0].textContent);
    const tbody = fila.closest('tbody');
    const filas = Array.from(tbody.querySelectorAll('tr'));

    filas.sort((filaA, filaB) => {
        // Primero ordenar por estado (Titular primero)
        const estadoA = filaA.querySelector('.botonSuplenteTitular').textContent;
        const estadoB = filaB.querySelector('.botonSuplenteTitular').textContent;

        if (estadoA !== estadoB) {
            return estadoB.localeCompare(estadoA); // Ordenar Titular antes que Suplente
        }

        // Luego, dentro de Titular, dar prioridad a los dorsales 1, 13, 25
        if (estadoA === 'Titular') {
            const dorsalA = parseInt(filaA.cells[0].textContent);
            const dorsalB = parseInt(filaB.cells[0].textContent);

            if ([1, 13, 25].includes(dorsalA) && ![1, 13, 25].includes(dorsalB)) {
                return -1;
            } else if (![1, 13, 25].includes(dorsalA) && [1, 13, 25].includes(dorsalB)) {
                return 1;
            } else {
                return dorsalA - dorsalB;
            }
        }

        return 0; // Si ambos son Suplentes, no cambiar el orden
    });

    // Limpiar y reinsertar las filas ordenadas
    filas.forEach(fila => {
        tbody.appendChild(fila);
    });
    actualizarContadorTitulares();
}



function obtenerEstado(fila) {
    // Obtener el valor de Titular o Suplente en la celda correspondiente
    return fila.cells[3].textContent.trim();
}

function obtenerOrdenDorsal(dorsal) {
    // Definir el orden deseado para los dorsales 1, 13 y 25
    switch (dorsal) {
        case 1:
            return 0;
        case 13:
            return 1;
        case 25:
            return 2;
        default:
            return 3;
    }
}
        function acumularTiempoFila(fila) {
            const celdaCronometro = fila.querySelector('.cronometro-fila span');
            const tiempoActual = obtenerTiempoFila(fila);
            const tiempoAcumulado = fila.dataset.tiempoAcumulado || '00:00:00.000';

            const [minActual, secActual, milisecActual] = tiempoActual.split(/[:.]+/).map(Number);
            const [minAcumulado, secAcumulado, milisecAcumulado] = tiempoAcumulado.split(/[:.]+/).map(Number);

            const minTotal = minActual + minAcumulado;
            const secTotal = secActual + secAcumulado;
            const milisecTotal = milisecActual + milisecAcumulado;

            fila.dataset.tiempoAcumulado = `${formatoDosDigitos(minTotal)}:${formatoDosDigitos(secTotal)}.${formatoTresDigitos(milisecTotal)}`;
        }

        function detenerCronometroFila(fila) {
            const celdaCronometro = fila.querySelector('.cronometro-fila span');
            const cronometroId = fila.dataset.cronometroId;

            if (cronometroId) {
                clearInterval(cronometroId);
                fila.removeAttribute('data-cronometro-id');
            }
        }

        function reiniciarCronometroFila(fila) {
            const celdaCronometro = fila.querySelector('.cronometro-fila span');
            detenerCronometroFila(fila);

            const tiempoAcumulado = fila.dataset.tiempoAcumulado || '00:00:00.000';
            celdaCronometro.textContent = tiempoAcumulado;
            iniciarCronometroFila(fila);
        }

        function obtenerTiempoFila(fila) {
            const celdaCronometro = fila.querySelector('.cronometro-fila span');
            const tiempoFila = celdaCronometro.textContent;
            return tiempoFila;
        }

        function iniciarCronometroFila(fila) {
            const celdaCronometro = fila.querySelector('.cronometro-fila span');

            let tiempoActual = fila.dataset.tiempoActual || '00:00:00.000';

            let [minutosFila, segundosFila, milisegundosFila] = tiempoActual.split(/[:.]+/).map(Number);

            const cronometroFila = setInterval(() => {
                if (cronometroActivo && fila.querySelector('.botonSuplenteTitular').textContent === 'Titular') {
                    let milisegundos = milisegundosFila + 100;
                    let segundos = segundosFila;
                    let minutos = minutosFila;

                    if (milisegundos >= 1000) {
                        milisegundos = 0;
                        segundos++;
                    }

                    if (segundos >= 60) {
                        segundos = 0;
                        minutos++;
                    }

                    tiempoActual = `${formatoDosDigitos(minutos)}:${formatoDosDigitos(segundos)}.${formatoTresDigitos(milisegundos)}`;
                    celdaCronometro.textContent = tiempoActual;

                    fila.dataset.tiempoActual = tiempoActual;
                    milisegundosFila = milisegundos;
                    segundosFila = segundos;
                    minutosFila = minutos;
                }
            }, 100);

            fila.dataset.cronometroId = cronometroFila;
        }
     function exportarModelo() {
  const jugadoresSeleccionados = obtenerJugadoresSeleccionados();
  console.log('Jugadores Seleccionados:', jugadoresSeleccionados);

  // Almacenar los jugadores seleccionados en localStorage
  localStorage.setItem('jugadoresSeleccionados', JSON.stringify(jugadoresSeleccionados));

  // Cerrar la ventana actual
  window.close();

  // Actualizar la página principal en el HTML 1
  window.opener.location.reload();
}


document.addEventListener('actualizarTablaPrincipal', () => {
    // Actualiza la tabla de jugadores o realiza cualquier otra acción necesaria
    cargarTablaPrincipal();
});

function cargarTablaPrincipal() {
    // Lógica para cargar la tabla principal
    // ...

    // Por ejemplo, puedes llamar a tu función cargarJugadoresSeleccionados
    const jugadoresSeleccionadosStorage = localStorage.getItem('jugadoresSeleccionados');
    if (jugadoresSeleccionadosStorage) {
        const jugadoresSeleccionados = JSON.parse(jugadoresSeleccionadosStorage);
        cargarJugadoresSeleccionados(jugadoresSeleccionados);
    }
}

function limpiarTabla() {
    // Mostrar cuadro de diálogo de confirmación
    const confirmacion = confirm('¿Está seguro de que desea limpiar la tabla?');

    // Si el usuario confirma, limpiar la tabla
    if (confirmacion) {
        const tablaJugadores = document.getElementById('jugadores-table');
        const tbodyJugadores = tablaJugadores.querySelector('tbody');
        tbodyJugadores.innerHTML = ''; // Limpiar el contenido del cuerpo de la tabla de jugadores

        const tablaRegistros = document.getElementById('registro-table');
        const tbodyRegistros = tablaRegistros.querySelector('tbody');
        tbodyRegistros.innerHTML = ''; // Limpiar el contenido del cuerpo de la tabla de registros

        // También puedes reiniciar cualquier otra lógica o datos relacionados con las tablas
    }
}
let idRegistro = 0; // Variable para asignar identificadores únicos

function registrarEvento(tiempo, columna, nombre, dorsal) {
    const registroTable = document.getElementById('registro-table');
    const tbody = registroTable.querySelector('tbody');
    const fila = document.createElement('tr');

    // Asignar un identificador único a la fila
    const idFila = 'registro_' + idRegistro++;
    fila.id = idFila;

    fila.innerHTML = `
        <td>${tiempo}</td>
        <td>${dorsal}</td>
        <td>${nombre}</td>
        <td>${columna}</td>
        <td>
            <button onclick="eliminarFila('${idFila}')">-</button>
        </td>
    `;

    tbody.appendChild(fila);
}

function eliminarFila(idFila) {
    const fila = document.getElementById(idFila);
    if (fila) {
        const confirmacion = confirm('¿Estás seguro de que deseas eliminar esta fila?');

        if (confirmacion) {
            fila.remove();
        }
    }
}

function eliminarRegistro(idFila) {
    const fila = document.getElementById(idFila);
    if (fila) {
        fila.remove();
    }
}

function registrarEventoTecla(tiempo, columna, jugador, dorsal) {
    const nombreColumna = obtenerNombreColumna(columna);
    const nombreJugador = jugador.Jugador;
    registrarEvento(tiempo, nombreColumna, nombreJugador, dorsal);
}

function obtenerNombreColumna(columna) {
    switch (columna) {
        case 5:
            return 'Gol a favor';
        case 6:
            return 'Gol en contra';
        case 7:
            return 'Asistencia';
        case 8:
            return 'Tarjeta Amarilla';
        case 9:
            return 'Tarjeta Roja';
        default:
            return 'Otra Columna';
    }
}


function ordenarTablaPorTitularSuplente() {
    const tabla = document.getElementById('jugadores-table');
    const tbody = tabla.querySelector('tbody');
    
    // Obtener todas las filas del tbody
    const filas = Array.from(tbody.querySelectorAll('tr'));

    // Ordenar las filas en función de la quinta columna (Titular/Suplente)
    filas.sort((filaA, filaB) => {
        const columnaTitularSuplenteA = filaA.cells[4].textContent.toLowerCase();
        const columnaTitularSuplenteB = filaB.cells[4].textContent.toLowerCase();

        if (columnaTitularSuplenteA < columnaTitularSuplenteB) {
            return -1;
        }
        if (columnaTitularSuplenteA > columnaTitularSuplenteB) {
            return 1;
        }
        return 0;
    });

    // Limpiar el tbody
    tbody.innerHTML = '';

    // Agregar las filas ordenadas al tbody
    filas.forEach((fila) => {
        tbody.appendChild(fila);
    });
}


// Actualiza la función existente restarValor y sumarValor para incluir el registro de eventos
function restarValor(spanNumero) {
    let valorActual = parseInt(spanNumero.textContent) || 0;
    const columna = spanNumero.parentElement.cellIndex;
    const fila = spanNumero.closest('tr');

    // Disminuir el valor si es mayor que 0
    if (valorActual > 0) {
        valorActual--;
        spanNumero.textContent = valorActual;

        // Actualizar marcador si es necesario
        actualizarMarcador(columna, false, fila);
    }


    spanNumero.textContent = valorActual;
}

function sumarValor(spanNumero) {
    let valorActual = parseInt(spanNumero.textContent) || 0;
    const columna = spanNumero.parentElement.cellIndex;
    const fila = spanNumero.closest('tr');

    // Aumentar el valor
    valorActual++;
    spanNumero.textContent = valorActual;

    // Actualizar marcador si es necesario
    actualizarMarcador(columna, true, fila);


    const tiempo = obtenerTiempoGeneral();
    const jugador = obtenerJugador(spanNumero);
    registrarEventoTecla(tiempo, columna, jugador, jugador.Dorsal);

    spanNumero.textContent = valorActual;
}

function actualizarMarcador(columna, sumar, fila) {
    // Identificar si la modificación es para goles a favor o en contra
    if (columna === 5) { // Asumiendo que la columna 5 es "Goles a favor"
        const golesLocal = document.getElementById('goles-local');
        let goles = parseInt(golesLocal.textContent);
        goles = sumar ? goles + 1 : goles - 1;
        golesLocal.textContent = goles.toString();
    } else if (columna === 6) { // Asumiendo que la columna 6 es "Goles en contra"
        const golesVisitante = document.getElementById('goles-visitante');
        let goles = parseInt(golesVisitante.textContent);
        goles = sumar ? goles + 1 : goles - 1;
        golesVisitante.textContent = goles.toString();
    }
}

function obtenerTiempoGeneral() {
    const tiempoGeneral = document.getElementById('tiempo').textContent;
    return tiempoGeneral;
}

function obtenerJugador(spanNumero) {
    const fila = spanNumero.closest('tr');
    const jugador = {
        Dorsal: fila.cells[0].textContent,
        Jugador: fila.cells[1].textContent,
        Equipo: fila.cells[2].textContent,
    };
    return jugador;
}

function exportarPartido() {
    if (confirm("¿Deseas exportar el partido a Excel? Pulsa Cancelar para exportar a PDF.")) {
        exportarAExcel();
    } else {
        exportarAPDF();
    }
}


function exportarAExcel() {
    // Obtén el nombre del archivo del formulario
    var nombreArchivo = document.getElementById('jornada').value + '.' +
                        document.getElementById('equipo').value + '.' +
                       document.getElementById('rival').value + '.' +
                       document.getElementById('fecha').value;

    // Crear el contenido del archivo Excel
    var workbook = XLSX.utils.book_new();

    // Agregar una hoja para los datos del formulario
    exportarFormulario(workbook);

    // Exportar la primera tabla ("jugadores-table")
    exportarTabla("jugadores-table", "Jugadores", workbook);

    // Exportar la segunda tabla ("registro-table")
    exportarTabla("registro-table", "Registro", workbook);

    // Generar el archivo Excel
    XLSX.writeFile(workbook, nombreArchivo + '.xlsx');
}

function exportarAPDF() {
    // Usar html2canvas para capturar el contenido de la página
    html2canvas(document.body).then(canvas => {
        // Inicializar jsPDF
        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
        // Calcular el ancho y el alto para mantener la proporción del contenido capturado
        const imgWidth = 210; // ancho de una página A4 en mm
        const imgHeight = canvas.height * imgWidth / canvas.width;

        // Convertir la imagen del canvas a un DataURL
        const imgData = canvas.toDataURL('image/png');
        
        // Añadir la imagen al documento PDF
        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
        
        // Obtener el nombre del archivo de los datos del formulario
        var nombreArchivo = document.getElementById('jornada').value + '.' +
                            document.getElementById('equipo').value + '.' +
                            document.getElementById('rival').value + '.' +
                            document.getElementById('fecha').value;

        // Guardar el PDF
        pdf.save(nombreArchivo + '.pdf');
    });
}


function exportarFormulario(workbook) {
    // Obtener la información del formulario
    var jornada = document.getElementById('jornada').value;
    var fecha = document.getElementById('fecha').value;
    var equipo = document.getElementById('equipo').value;
    var rival = document.getElementById('rival').value;
    var resultado = document.getElementById('resultado').value;

    // Crear una hoja de cálculo para los datos del formulario
    var worksheet = XLSX.utils.json_to_sheet([
        { 'Jornada': jornada, 'Fecha': fecha, 'Equipo': equipo, 'Rival': rival, 'Resultado': resultado }
    ]);

    // Añadir la hoja al libro
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Formulario');
}

function exportarTabla(idTabla, nombreHoja, workbook) {
    // Obtener la referencia de la tabla
    var table = document.getElementById(idTabla);

    // Convertir la tabla a formato de hoja de cálculo
    var worksheet = XLSX.utils.table_to_sheet(table);

    // Añadir la hoja al libro
    XLSX.utils.book_append_sheet(workbook, worksheet, nombreHoja);
}

 
 // Función para recargar la página principal
 function ejecutarRecargaPaginaPrincipal() {
    // Recargar la página principal después de un breve retraso (1000 milisegundos = 1 segundo)
    setTimeout(() => {
      location.reload();
    }, 1000);
  }

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
  .then(function(registration) {
    // Registro exitoso
    console.log('Service Worker registrado con scope:', registration.scope);
  }).catch(function(err) {
    // Registro fallido
    console.log('Service Worker registro fallido:', err);
  });
}
// En tu archivo HTML principal
var worker = new Worker('cronometroWorker.js');

worker.onmessage = function(event) {
    document.getElementById('cronometro').textContent = event.data;
};

worker.postMessage({ start: true });

// En tu cronometroWorker.js
let tiempo = 0;
self.onmessage = function(event) {
    if (event.data.start) {
        setInterval(function() {
            tiempo++;
            self.postMessage(tiempo);
        }, 1000);
    }
};
  // Escuchar mensajes del HTML secundario (html2)
  window.addEventListener('message', (event) => {
    if (event.data.actualizar) {
        const jugadoresSeleccionadosStorage = localStorage.getItem('jugadoresSeleccionados');
        if (jugadoresSeleccionadosStorage) {
            const jugadoresSeleccionados = JSON.parse(jugadoresSeleccionadosStorage);
            cargarJugadoresSeleccionados(jugadoresSeleccionados);
        }
    }
});

function actualizarContadorTitulares() {
    const tipoFutbol = document.getElementById('tipo-futbol').value;
    const contadorTitulares = document.querySelectorAll('.botonSuplenteTitular.fondo-verde').length;
    const maxTitulares = parseInt(tipoFutbol);
    
    document.getElementById('numero-titulares-moderno').textContent = contadorTitulares;
    
    const mensajeAdvertencia = document.getElementById('mensaje-advertencia');
    if (contadorTitulares < maxTitulares) {
        mensajeAdvertencia.innerHTML = 'Cuidado, te faltan jugadores';
        parpadearMensaje(mensajeAdvertencia);
    } else if (contadorTitulares > maxTitulares) {
        mensajeAdvertencia.innerHTML = 'Cuidado, te sobran titulares';
        parpadearMensaje(mensajeAdvertencia);
    } else {
        mensajeAdvertencia.style.display = 'none';
    }
}

function parpadearMensaje(elemento) {
    elemento.style.display = 'block';
    let visible = true;
    setInterval(() => {
        elemento.style.visibility = visible ? 'hidden' : 'visible';
        visible = !visible;
    }, 500);
}

median.screen.keepScreenOn();
    </script>

</body>
</html>





